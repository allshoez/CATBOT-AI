<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
<link rel="manifest" href="manifest.json">

<!-- Highlight.js CSS & JS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script>hljs.highlightAll();</script>

<title>CatBot PWA</title>
<style>
:root{
  --wa-green:#075e54;
  --bg:#ece5dd;
  --me:#dcf8c6;
  --other:#fff;
}

/* ===== Body & Header ===== */
body {
  margin:0;
  font-family: Segoe UI, sans-serif;
  background: var(--bg);
  font-size: 18px;
}
header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  background: var(--wa-green);
  color:#fff;
  padding:10px 12px;
  position:sticky;
  top:0;
  z-index:10;
}
.left { display:flex; align-items:center; gap:10px }
header img { width:40px; height:40px; border-radius:50% }
.title { line-height:1 }
.title b { display:block; font-size:16px }
.title small { opacity:.8 }
.actions { display:flex; align-items:center; gap:8px }
.chip {
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  background:#ffffff26;
  cursor:pointer;
  user-select:none;
}
.fab { background:none; border:none; color:#fff; font-size:22px; cursor:pointer }

/* ===== Chat ===== */
#chat {
  padding:12px;
  min-height: calc(100vh - 120px);
  display:flex;
  flex-direction:column;
  gap:8px;
  overflow-y:auto;
}
.msg {
  max-width:80%;
  padding:10px 12px;
  border-radius:10px;
  box-shadow:0 1px 1px #0001;
  word-wrap:break-word;
  position:relative;
  font-size:18px;

  white-space: pre-line;  /* <- ini biar \n jadi baris baru */
  line-height: 1.6;       /* <- jarak antar kalimat lebih enak */
}
.user { align-self:flex-end; background:var(--me); border-top-right-radius:4px }
.bot { align-self:flex-start; background:var(--other); border-top-left-radius:4px }
.meta { margin-top:4px; font-size:11px; opacity:.65; text-align:right }
.copyBtn {
  position: absolute;
  top: 4px;
  right: 4px;
  background: none;
  border: none;
  font-size: 14px;
  cursor: pointer;
  opacity: 0;
  transition: opacity .2s;
}
.msg:hover .copyBtn { opacity:0.7 }
.msg:hover .copyBtn:hover { opacity:1 }

/* ===== Footer ===== */
footer {
  position:sticky;
  bottom:0;
  background:#fff;
  border-top:1px solid #0001;
  padding:10px;
}
.row { display:flex; gap:8px; align-items:center }
#prompt {
  flex:1;
  resize:none;
  height:42px;
  padding:10px;
  border:1px solid #0002;
  border-radius:22px;
  font-size:18px;
}
.send {
  background:var(--wa-green);
  color:#fff;
  border:none;
  border-radius:50%;
  width:42px; height:42px;
  cursor:pointer;
}
.clear {
  background:#eee;
  border:none;
  border-radius:50px;
  padding:0 12px;
  font-size:13px;
  cursor:pointer;
}

/* ===== Popup API / Settings ===== */
#popup {
  display: none;
  position: fixed;
  top: 10px;
  right: 10px;
  width: min(92vw, 320px);
  max-height: 80vh;
  overflow-y: auto;
  background: #fff;
  border-radius: 12px;
  padding: 10px;
  z-index: 100;
  box-shadow: 0 10px 30px rgba(0,0,0,.4);
}
#popup.active { display:block }
#popup .card { display:flex; flex-direction:column; gap:10px; position:relative }
#popup h3 { margin:0 0 10px }
.closeX {
  position: sticky;
  top: 0;
  right: 0;
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
  z-index:110;
}

/* ===== Popup Media ===== */
#mediaPopup {
  display:none;
  position: absolute;
  bottom: 20px;
  left:50%;
  transform:translateX(-50%);
  width:min(92vw,360px);
  max-height:60vh;
  overflow-y:auto;
  background:#fff;
  border-radius:12px;
  padding:12px;
  z-index:90;
  box-shadow: 0 8px 20px rgba(0,0,0,.3);
}
#mediaPopup.active { display:block }
.popupContent {
  display:flex;
  flex-direction:column;
  gap:8px;
}
.mediaBtn {
  padding:10px;
  border-radius:8px;
  background:#eee;
  text-align:left;
  cursor:pointer;
}
.closePopup {
  position:sticky;
  top:0;
  margin-top:8px;
  padding:6px;
  border:none;
  background:#ddd;
  border-radius:8px;
  cursor:pointer;
}

/* ===== Grid Form ===== */
.grid { display:grid; grid-template-columns:1fr 1fr; gap:10px }
.grid .col-2 { grid-column:1/-1 }
label { font-size:12px; opacity:.85 }
input, select { width:100%; padding:8px; border:1px solid #0002; border-radius:8px; margin-top:4px }
.note { font-size:12px; opacity:.8; margin:6px 0 10px }
.btnRow { display:flex; gap:8px; margin-top:10px }
.btn { flex:1; padding:10px; border:none; border-radius:8px; cursor:pointer }
.primary { background:var(--wa-green); color:#fff }
.danger { background:#eee 
}

.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #333;
  color: #fff;
  padding: 10px 20px;
  border-radius: 5px;
  opacity: 1;
  transition: opacity 0.5s ease-out; /* Animasi saat hilang */
}

.toast.fade-out {
  opacity: 0;
}
</style>
</head>

<body>
<header>
  <div class="left">
    <img src="https://i.pravatar.cc/100?img=47" alt="cewe">
    <div class="title"><b>CatBot</b><small id="status">online</small></div>
  </div>
  <div class="actions">
    <span id="providerBadge" class="chip" title="Klik untuk ganti provider">Gemini</span>
    <button id="openPopup" class="fab" title="API Keys">+</button>
  </div>
</header>

<main id="chat"></main>

<footer>
  <div class="row">
    <button id="btnClear" class="clear">=</button>
    <textarea id="prompt" placeholder="Tulis pesan‚Ä¶"></textarea>
    <button id="btnSend" class="send">‚û§</button>
  </div>
</footer>

<div id="mediaPopup" class="popup">
  <div class="popupContent">
    <div class="mediaBtn" id="btnCamera">üì∑ Kamera</div>
    <div class="mediaBtn" id="btnPhoto">üñºÔ∏è Foto</div>
    <div class="mediaBtn" id="btnFile">üìé File</div>
    <div class="mediaBtn" id="btnClearChat">üßπ Clear Chat</div>
    <button class="closePopup">‚úï</button>
  </div>
</div>

<div id="popup" aria-hidden="true">
  <div class="card" role="dialog" aria-modal="true" aria-labelledby="ttl">
    <button id="closePopup" class="closeX">‚úï</button>
    <h3 id="ttl">Pengaturan & API Keys</h3>
    <p class="note">Kunci disimpan lokal di <code>localStorage</code>. Gunakan server proxy untuk produksi.</p>
    <div class="grid">
      <div class="col-2">
        <label for="providerSel">Provider aktif</label>
        <select id="providerSel">
          <option value="gemini">Gemini</option>
          <option value="openai">OpenAI</option>
        </select>
      </div>
      <div class="col-2">
        <label for="systemPrompt">System prompt (opsional)</label>
        <input id="systemPrompt" placeholder="mis: jawab singkat, bahasa Indonesia">
      </div>
      <div class="col-2" style="margin-top:6px"><b>üî∑ Gemini</b></div>
      <div class="col-2">
        <label for="geminiKey">Gemini API Key</label>
        <input id="geminiKey" type="password" placeholder="AI...">
      </div>
      <div>
        <label for="geminiModel">Model</label>
        <select id="geminiModel">
          <option value="gemini-1.5-flash">gemini-1.5-flash</option>
          <option value="gemini-1.5-pro">gemini-1.5-pro</option>
        </select>
      </div>
      <div>
        <label for="gemTemp">Temperature</label>
        <input id="gemTemp" type="number" step="0.1" min="0" max="2" value="1">
      </div>
      <div class="col-2" style="margin-top:6px"><b>üü£ OpenAI</b></div>
      <div class="col-2">
        <label for="openaiKey">OpenAI API Key</label>
        <input id="openaiKey" type="password" placeholder="sk-...">
      </div>
      <div>
        <label for="openaiModel">Model</label>
        <select id="openaiModel">
          <option value="gpt-4o-mini">gpt-4o-mini</option>
          <option value="gpt-4o">gpt-4o</option>
          <option value="gpt-4.1-mini">gpt-4.1-mini</option>
        </select>
      </div>
      <div>
        <label for="oaTemp">Temperature</label>
        <input id="oaTemp" type="number" step="0.1" min="0" max="2" value="1">
      </div>
    </div>
    <div class="btnRow">
      <button id="btnSave" class="btn primary">Simpan</button>
      <button id="btnWipe" class="btn danger">Hapus Lokal</button>
    </div>
  </div>
</div>

<script src="script.js"></script>


</body>
</html>
